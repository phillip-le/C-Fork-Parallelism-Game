#include "errors.h"
#include "utility.h"
#include "path.h"
#include "game.h"
#include "player.h"
#include "coms.h"
#include "stdio.h"
#include "stdlib.h"

int main(int argc, char** argv) {
    check_player_args(argc, argv);
    int playerCount = strtol(argv[2], NULL, 10);
    int pid = strtol(argv[3], NULL, 10);
    printf("^");
    fflush(stdout);
    
    char* pathString = read_line(stdin);
    if (pathString == NULL) {
        exit(player_error_msg(PLAYER_BAD_PATH));
    }
    Game* game = init_game(pid, playerCount, pathString);
    if (game == NULL) {
        free(pathString);
        exit(player_error_msg(PLAYER_BAD_PATH));
    }
    free(pathString);
    while (!game_over(game)) {
        char* update = read_line(stdin);
        if (update != NULL) {
            recv_dealer_msg(game, pid, update);
        } else {
            exit(player_error_msg(PLAYER_COMS));
        }
    }
    exit(PLAYER_OK);
}